from flask import Flask, render_template, request, jsonify
import joblib

app = Flask(__name__)

# Load TF-IDF vectorizer
tfidf_vectorizer = joblib.load("tfidf_vectorizer.pkl")

# Load SVM model trained with TF-IDF vectors
svm_tfidf_model = joblib.load("svm_tfidf_model.pkl")

def preprocess_text(text):
    # Implement text preprocessing here (cleaning, lemmatization, etc.)
    return text

def predict_sentiment(review):
    preprocessed_review = preprocess_text(review)
    print("Preprocessed text:", preprocessed_review)  # Print preprocessed text
    # Vectorize the review using the loaded TF-IDF vectorizer
    review_tfidf = tfidf_vectorizer.transform([preprocessed_review])
    print("TF-IDF vectorized representation:", review_tfidf)  # Print TF-IDF vectorized representation
    # Predict sentiment using the loaded SVM model
    sentiment = svm_tfidf_model.predict(review_tfidf)[0]
    return int(sentiment)  # Convert numpy.int64 to regular int

def map_sentiment(sentiment):
    if sentiment == 0:
        return "Negative"
    elif sentiment == 1:
        return "Positive"
    else:
        return "Unknown"
    
@app.route('/')
def index():
    return render_template('index.html')

@app.route('/predict', methods=['POST'])
def predict():
    data = request.get_json(force=True)
    review = data['review']
    sentiment = predict_sentiment(review)
    return jsonify(sentiment=sentiment)

if __name__ == '__main__':
    app.run(debug=True)
